<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Aesva Impute Time</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-cHvTkV5ZBj8eJUkxdNR03iDgFMG5n3ewA9qAQz5GwX+dyNsa6yEbcJz9YQf5nD70" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/calendar-year.css" />
    <link rel="icon" type="image/png" href="assets/favicon.png" />
</head>

<body>
    <!-- Encabezado de la aplicación -->
    <header class="app-header navbar navbar-dark bg-primary fixed-top">
        <div class="container-fluid app-header__inner">
            <button class="navbar-toggler me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterPane" aria-controls="filterPane" aria-label="Mostrar menú">
                <span class="navbar-toggler-icon"></span>
            </button>
            <span class="navbar-brand app-title">Aesva Impute Time <span id="envLabel" class="env-indicator"></span></span>
            <span class="app-subtitle ms-auto">Gestión e imputación de horas</span>
        </div>
    </header>

    <main class="container-fluid mt-3 d-lg-flex gap-3">
        <!-- Panel lateral (menú + filtros) -->
        <aside id="filterPane" class="offcanvas offcanvas-start" tabindex="-1" aria-labelledby="filterPaneLabel">
            <div class="offcanvas-header">
                <h5 id="filterPaneLabel" class="offcanvas-title">Menú</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
            </div>
            <nav class="menu-block offcanvas-body">
                <ul class="menu-buttons">
                    <li><button id="btnCustomers" class="btn btn-primary w-100" type="button"><i class="bi bi-people-fill me-1"></i>Clientes</button></li>
                    <li><button id="btnTasks" class="btn btn-primary w-100" type="button"><i class="bi bi-list-check me-1"></i>Tareas</button></li>
                    <li><button id="btnCalendar" class="btn btn-primary w-100" type="button"><i class="bi bi-calendar-event me-1"></i>Calendario</button></li>
                    <li><button id="btnCompany" class="btn btn-primary w-100" type="button"><i class="bi bi-building me-1"></i>Empresa</button></li>
                    <li><button id="btnInvoices" class="btn btn-primary w-100" type="button"><i class="bi bi-receipt me-1"></i>Facturas</button></li>
                    <li><button id="btnConfig" class="btn btn-primary w-100" type="button"><i class="bi bi-gear me-1"></i>Configuración</button></li>
                </ul>
            </nav>
            <div class="filters-block mt-3">
                <h3 class="menu-title">Vistas</h3>
                <ul class="filter-list">
                    <li data-filter="all" class="active">Todo</li>
                    <li data-filter="today">Hoy</li>
                    <li data-filter="week">Esta semana</li>
                    <li data-filter="month">Mes</li>
                    <li data-filter="prevMonth">Mes anterior</li>
                </ul>
                <input type="text" id="searchFilter" class="form-control form-control-sm" placeholder="Filtrar lista" aria-label="Filtrar lista" />
            </div>
        </aside>

        <div class="content">
            <!-- Control de fichaje -->
            <section id="fichaje" class="card">
                <div id="DivPadre">
                    <div id="DivContainer">
                        <div id="DivContainerTiempoTrabajado">
                            <div class="TiempoTrabajado" id="TitleTiempoTotalTrabajado">Tiempo total (hoy)</div>
                            <div class="TiempoTrabajado" id="TiempoTotalTrabajado">00:00:00</div>
                        </div>

                        <!-- Selector de tarea actual estilizado -->
                        <div class="current-task-block">
                            <label for="currentTaskSelect" class="field-label">Tarea actual</label>
                            <input id="currentTaskSelect" class="field-control" list="taskOptions" />
                            <datalist id="taskOptions"></datalist>
                        </div>

                        <div id="DivContainerButtons" class="d-flex justify-content-center gap-2">
                            <button class="btn btn-success" id="BtnEntrar" type="button" aria-label="Entrar"><i class="bi bi-play-fill"></i></button>
                            <button class="btn btn-danger" id="BtnSalir" type="button" disabled aria-label="Salir"><i class="bi bi-stop-fill"></i></button>
                        </div>
                        <div id="DivUltimaAccion">
                            <div class="TextUltima" id="UltimaAccionEntrada"></div>
                            <div class="TextUltima" id="UltimaAccionSalida"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tabla de imputaciones -->
            <section id="tableWrapper" class="card">
                <header class="section-header">
                    <h2>Imputaciones</h2>
                    <div class="header-buttons">
                        <button class="btn btn-primary btn-sm" id="BtnAddImputation" type="button" aria-label="Nueva imputación"><i class="bi bi-plus-circle"></i></button>
                        <button class="btn btn-secondary btn-sm" id="BtnEditImputation" type="button" disabled aria-label="Editar"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-danger btn-sm" id="BtnDelImputation" type="button" disabled aria-label="Eliminar"><i class="bi bi-trash"></i></button>
                        <button class="btn btn-secondary btn-sm" id="BtnLoadAllImp" type="button" aria-label="Cargar todo"><i class="bi bi-download"></i></button>
                        <button class="btn btn-secondary btn-sm" id="BtnExportImp" type="button" aria-label="Exportar CSV"><i class="bi bi-file-earmark-spreadsheet"></i></button>
                    </div>
                </header>
                <div class="table-responsive">
                    <table id="imputationsTable">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Entrada</th>
                                <th>Salida</th>
                                <th>Total</th>
                                <th>Decimal</th>
                                <th>Minutos</th>
                                <th>Tarea</th>
                                <th>Nº tarea cliente</th>
                                <th>No Fee</th>
                                <th>Festivo</th>
                                <th>Vacaciones</th>
                                <th>Comentarios</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="totalsBar">
                    <div><span>Tiempo trabajado:</span><strong id="totWorked">00:00:00</strong></div>
                    <div><span>Tiempo Decimal:</span><strong id="totDecimal">0</strong></div>
                    <div><span>Tiempo en minutos:</span><strong id="totMinutes">0</strong></div>
                    <div><span>Total horas laborales:</span><strong id="totLabor">0</strong></div>
                    <div><span>Horas previstas:</span><strong id="totExpected">0</strong></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Template modal de Imputaciones -->
    <template id="imputationModalTmpl">
        <div class="modal-backdrop">
            <div class="modal">
                <header>
                    <span class="modal-title">Nueva imputación</span>
                    <button class="close" type="button">×</button>
                </header>
                <form id="imputationForm">
                    <input type="hidden" name="id" />
                    <label class="form-label">Fecha
                        <input type="date" name="date" class="form-control" required />
                    </label>
                    <label class="form-label">Hora entrada
                        <input type="time" name="inTime" class="form-control" step="900" required />
                    </label>
                    <label class="form-label">Hora salida
                        <input type="time" name="outTime" class="form-control" step="900" />
                    </label>
                    <label class="form-label">Tarea
                        <input name="taskId" class="form-control" list="taskOptions" />
                    </label>
                    <label class="form-check-label check"><input class="form-check-input" type="checkbox" name="noFee" /> No Fee</label>
                    <label class="full form-label">Comentarios
                        <input type="text" name="comments" class="form-control" />
                    </label>
                    <footer class="full text-end mt-3">
                        <button type="submit" class="btn btn-primary"><i class="bi bi-check"></i> Guardar</button>
                    </footer>
                </form>
            </div>
        </div>
    </template>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-QSleKzfFs1ZW1GM5eS+oEtC5n4ofRwSEopgI0N03vLOjObT8CV+zsrq30I3fKZf7" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/conection-bbdd.js"></script>
    <script src="js/config.js"></script>
    <script src="js/google-ai.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/impute-hours.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/calendar-year.js"></script>
    <script src="js/company.js"></script>
    <script src="js/invoice-print.js"></script>
    <script src="js/invoices.js"></script>
</body>

</html>