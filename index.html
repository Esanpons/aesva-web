<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Aesva Impute Time</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/calendar-year.css" />
    <link rel="icon" type="image/png" href="assets/favicon.png" />
</head>

<body>
    <!-- Encabezado de la aplicación -->
    <header class="app-header">
        <div class="app-header__inner">
            <div class="app-title">Aesva Impute Time <span id="envLabel" class="env-indicator"></span></div>
            <div class="app-subtitle">Gestión e imputación de horas</div>
        </div>
    </header>

    <main>
        <!-- Panel lateral (menú + filtros) -->
        <aside id="filterPane">
            <nav class="menu-block">
                <h3 class="menu-title">Menú</h3>
                <ul class="menu-buttons">
                    <li><button id="btnCustomers" class="btn btn-primary icon-btn" type="button" title="Clientes" aria-label="Clientes"><span class="material-icons">groups</span></button></li>
                    <li><button id="btnTasks" class="btn btn-primary icon-btn" type="button" title="Tareas" aria-label="Tareas"><span class="material-icons">list_alt</span></button></li>
                    <li><button id="btnCalendar" class="btn btn-primary icon-btn" type="button" title="Calendario" aria-label="Calendario"><span class="material-icons">calendar_today</span></button></li>
                    <li><button id="btnCompany" class="btn btn-primary icon-btn" type="button" title="Empresa" aria-label="Empresa"><span class="material-icons">business</span></button></li>
                    <li><button id="btnInvoices" class="btn btn-primary icon-btn" type="button" title="Facturas" aria-label="Facturas"><span class="material-icons">receipt_long</span></button></li>
                    <li><button id="btnConfig" class="btn btn-primary icon-btn" type="button" title="Configuración" aria-label="Configuración"><span class="material-icons">settings</span></button></li>
                </ul>
            </nav>

            <div class="filters-block">
                <h3 class="menu-title">Vistas</h3>
                <ul class="filter-list">
                    <li data-filter="all" class="active">Todo</li>
                    <li data-filter="today">Hoy</li>
                    <li data-filter="week">Esta semana</li>
                    <li data-filter="month">Mes</li>
                    <li data-filter="prevMonth">Mes anterior</li>
                </ul>
                <input type="text" id="searchFilter" placeholder="Filtrar lista por..." />
            </div>
        </aside>

        <div class="content">
            <!-- Control de fichaje -->
            <section id="fichaje" class="card">
                <div id="DivPadre">
                    <div id="DivContainer">
                        <div id="DivContainerTiempoTrabajado">
                            <div class="TiempoTrabajado" id="TitleTiempoTotalTrabajado">Tiempo total (hoy)</div>
                            <div class="TiempoTrabajado" id="TiempoTotalTrabajado">00:00:00</div>
                        </div>

                        <!-- Selector de tarea actual estilizado -->
                        <div class="current-task-block">
                            <label for="currentTaskSelect" class="field-label">Tarea actual</label>
                            <input id="currentTaskSelect" class="field-control" list="taskOptions" />
                            <datalist id="taskOptions"></datalist>
                        </div>

                        <div id="DivContainerButtons">
                            <button class="btn icon-btn" id="BtnEntrar" type="button" title="Entrar" aria-label="Entrar"><span class="material-icons">play_arrow</span></button>
                            <button class="btn icon-btn" id="BtnSalir" type="button" disabled title="Salir" aria-label="Salir"><span class="material-icons">stop</span></button>
                        </div>
                        <div id="DivUltimaAccion">
                            <div class="TextUltima" id="UltimaAccionEntrada"></div>
                            <div class="TextUltima" id="UltimaAccionSalida"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tabla de imputaciones -->
            <section id="tableWrapper" class="card">
                <header class="section-header">
                    <h2>Imputaciones</h2>
                    <div class="header-buttons">
                        <button class="btn icon-btn" id="BtnAddImputation" type="button" title="Añadir imputación" aria-label="Añadir imputación"><span class="material-icons">add</span></button>
                        <button class="btn btn-primary icon-btn" id="BtnEditImputation" type="button" disabled title="Editar" aria-label="Editar"><span class="material-icons">edit</span></button>
                        <button class="btn icon-btn" id="BtnDelImputation" type="button" disabled title="Eliminar" aria-label="Eliminar"><span class="material-icons">delete</span></button>
                        <button class="btn icon-btn" id="BtnLoadAllImp" type="button" title="Cargar todo" aria-label="Cargar todo"><span class="material-icons">sync</span></button>
                        <button class="btn icon-btn" id="BtnExportImp" type="button" title="Exportar CSV" aria-label="Exportar CSV"><span class="material-icons">file_upload</span></button>
                    </div>
                </header>
                <div class="table-responsive">
                    <table id="imputationsTable">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Entrada</th>
                                <th>Salida</th>
                                <th>Total</th>
                                <th>Decimal</th>
                                <th>Minutos</th>
                                <th>Tarea</th>
                                <th>Nº tarea cliente</th>
                                <th>No Fee</th>
                                <th>Festivo</th>
                                <th>Vacaciones</th>
                                <th>Comentarios</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div id="totalsBar">
                    <div><span>Tiempo trabajado:</span><strong id="totWorked">00:00:00</strong></div>
                    <div><span>Tiempo Decimal:</span><strong id="totDecimal">0</strong></div>
                    <div><span>Tiempo en minutos:</span><strong id="totMinutes">0</strong></div>
                    <div><span>Total horas laborales:</span><strong id="totLabor">0</strong></div>
                    <div><span>Horas previstas:</span><strong id="totExpected">0</strong></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Template modal de Imputaciones -->
    <template id="imputationModalTmpl">
        <div class="modal-backdrop">
            <div class="modal">
                <header>
                    <span class="modal-title">Nueva imputación</span>
                    <button class="close" type="button">×</button>
                </header>
                <form id="imputationForm">
                    <input type="hidden" name="id" />
                    <label>Fecha
                        <input type="date" name="date" required />
                    </label>
                    <label>Hora entrada
                        <input type="time" name="inTime" step="900" required />
                    </label>
                    <label>Hora salida
                        <input type="time" name="outTime" step="900" />
                    </label>
                    <label>Tarea
                        <input name="taskId" list="taskOptions" />
                    </label>
                    <label class="check"><input type="checkbox" name="noFee" /> No Fee</label>
                    <label class="full">Comentarios
                        <input type="text" name="comments" />
                    </label>
                    <footer class="full">
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </footer>
                </form>
            </div>
        </div>
    </template>

    <!-- Scripts -->
    <script src="js/conection-bbdd.js"></script>
    <script src="js/config.js"></script>
    <script src="js/google-ai.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/impute-hours.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/calendar-year.js"></script>
    <script src="js/company.js"></script>
    <script src="js/invoice-print.js"></script>
    <script src="js/invoices.js"></script>
</body>

</html>