<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Aesva Impute Time</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- Bootstrap 5.3 & MDC-Web v15 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/material-components-web@15.0.0/dist/material-components-web.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/calendar-year.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="icon" type="image/png" href="assets/favicon.png" />
</head>

<body>
    <!-- Top App Bar & Segmented buttons -->
    <header class="mdc-top-app-bar mdc-top-app-bar--fixed" data-mdc-auto-init="MDCTopAppBar">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <button class="material-icons mdc-icon-button mdc-top-app-bar__navigation-icon" aria-label="menu">menu</button>
                <span class="mdc-top-app-bar__title">Aesva Impute Time</span>
            </section>
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                <div id="viewSegments" class="mdc-segmented-button" data-mdc-auto-init="MDCSegmentedButton">
                    <button class="mdc-segmented-button__segment mdc-segmented-button__segment--selected" aria-label="Todo" data-filter="all">
                        <span class="mdc-segmented-button__label">Todo</span>
                    </button>
                    <button class="mdc-segmented-button__segment" aria-label="Hoy" data-filter="today">
                        <span class="mdc-segmented-button__label">Hoy</span>
                    </button>
                    <button class="mdc-segmented-button__segment" aria-label="Semana" data-filter="week">
                        <span class="mdc-segmented-button__label">Esta semana</span>
                    </button>
                    <button class="mdc-segmented-button__segment" aria-label="Mes" data-filter="month">
                        <span class="mdc-segmented-button__label">Mes</span>
                    </button>
                    <button class="mdc-segmented-button__segment" aria-label="Mes anterior" data-filter="prevMonth">
                        <span class="mdc-segmented-button__label">Mes anterior</span>
                    </button>
                </div>
            </section>
        </div>
    </header>

    <main>
        <!-- Navigation Drawer -->
        <aside class="mdc-drawer mdc-drawer--dismissible" id="appDrawer" data-mdc-auto-init="MDCDrawer">
            <div class="mdc-drawer__content">
                <nav class="mdc-list">
                    <a class="mdc-list-item" id="btnCustomers" href="#" aria-label="Clientes">
                        <span class="material-icons mdc-list-item__graphic" aria-hidden="true">groups</span>
                        <span class="mdc-list-item__text">Clientes</span>
                    </a>
                    <a class="mdc-list-item" id="btnTasks" href="#" aria-label="Tareas">
                        <span class="material-icons mdc-list-item__graphic" aria-hidden="true">task</span>
                        <span class="mdc-list-item__text">Tareas</span>
                    </a>
                    <a class="mdc-list-item" id="btnCalendar" href="#" aria-label="Calendario">
                        <span class="material-icons mdc-list-item__graphic" aria-hidden="true">calendar_month</span>
                        <span class="mdc-list-item__text">Calendario</span>
                    </a>
                    <a class="mdc-list-item" id="btnCompany" href="#" aria-label="Empresa">
                        <span class="material-icons mdc-list-item__graphic" aria-hidden="true">domain</span>
                        <span class="mdc-list-item__text">Empresa</span>
                    </a>
                    <a class="mdc-list-item" id="btnInvoices" href="#" aria-label="Facturas">
                        <span class="material-icons mdc-list-item__graphic" aria-hidden="true">receipt_long</span>
                        <span class="mdc-list-item__text">Facturas</span>
                    </a>
                    <a class="mdc-list-item" id="btnConfig" href="#" aria-label="Configuración">
                        <span class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</span>
                        <span class="mdc-list-item__text">Configuración</span>
                    </a>
                </nav>
            </div>
        </aside>
        <div class="mdc-drawer-scrim"></div>

        <div class="content">
            <!-- Control de fichaje -->
            <section id="fichaje" class="card">
                <div id="DivPadre">
                    <div id="DivContainer">
                        <div id="DivContainerTiempoTrabajado">
                            <div class="TiempoTrabajado" id="TitleTiempoTotalTrabajado">Tiempo total (hoy)</div>
                            <div class="TiempoTrabajado" id="TiempoTotalTrabajado">00:00:00</div>
                        </div>

                        <!-- Selector de tarea actual estilizado -->
                        <div class="current-task-block">
                            <label for="currentTaskSelect" class="field-label">Tarea actual</label>
                            <input id="currentTaskSelect" class="field-control" list="taskOptions" />
                            <datalist id="taskOptions"></datalist>
                        </div>

                        <div id="DivContainerButtons">
                            <button class="Buttons" id="BtnEntrar" type="button">Entrar</button>
                            <button class="Buttons" id="BtnSalir" type="button" disabled>Salir</button>
                        </div>
                        <div id="DivUltimaAccion">
                            <div class="TextUltima" id="UltimaAccionEntrada"></div>
                            <div class="TextUltima" id="UltimaAccionSalida"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tabla de imputaciones -->
            <section id="tableWrapper" class="card">
                <header class="section-header">
                    <h2>Imputaciones</h2>
                    <div class="header-buttons">
                        <button class="mdc-fab mdc-fab--extended" id="BtnAddImputation" aria-label="Añadir imputación">
                            <span class="mdc-fab__ripple"></span>
                            <span class="material-icons mdc-fab__icon">add</span>
                            <span class="mdc-fab__label">Añadir imputación</span>
                        </button>
                        <button class="mdc-button mdc-button--outlined mdc-button--icon-leading" id="BtnEditImputation" disabled aria-label="Editar">
                            <span class="mdc-button__ripple"></span>
                            <i class="material-icons mdc-button__icon" aria-hidden="true">edit</i>
                            <span class="mdc-button__label">Editar</span>
                        </button>
                        <button class="mdc-button mdc-button--outlined mdc-button--icon-leading" id="BtnDelImputation" disabled aria-label="Eliminar">
                            <span class="mdc-button__ripple"></span>
                            <i class="material-icons mdc-button__icon" aria-hidden="true">delete</i>
                            <span class="mdc-button__label">Eliminar</span>
                        </button>
                        <button class="mdc-button mdc-button--outlined mdc-button--icon-leading" id="BtnLoadAllImp" aria-label="Cargar todo">
                            <span class="mdc-button__ripple"></span>
                            <i class="material-icons mdc-button__icon" aria-hidden="true">cloud_upload</i>
                            <span class="mdc-button__label">Cargar todo</span>
                        </button>
                        <button class="mdc-button mdc-button--outlined mdc-button--icon-leading" id="BtnExportImp" aria-label="Exportar CSV">
                            <span class="mdc-button__ripple"></span>
                            <i class="material-icons mdc-button__icon" aria-hidden="true">file_download</i>
                            <span class="mdc-button__label">Exportar CSV</span>
                        </button>
                        <input type="text" id="searchFilter" class="form-control form-control-sm" placeholder="Filtrar lista por..." />
                    </div>
                </header>
                <div class="mdc-data-table" id="imputationsTable" data-mdc-auto-init="MDCDataTable">
                    <table class="mdc-data-table__table" aria-label="Imputaciones">
                        <thead class="mdc-data-table__header">
                            <tr class="mdc-data-table__header-row">
                                <th class="mdc-data-table__header-cell" data-sortable="true">Fecha</th>
                                <th class="mdc-data-table__header-cell" data-sortable="true">Entrada</th>
                                <th class="mdc-data-table__header-cell" data-sortable="true">Salida</th>
                                <th class="mdc-data-table__header-cell" data-sortable="true">Total</th>
                                <th class="mdc-data-table__header-cell" data-sortable="true">Decimal</th>
                                <th class="mdc-data-table__header-cell" data-sortable="true">Minutos</th>
                                <th class="mdc-data-table__header-cell">Tarea</th>
                                <th class="mdc-data-table__header-cell">Nº tarea cliente</th>
                                <th class="mdc-data-table__header-cell">No Fee</th>
                                <th class="mdc-data-table__header-cell">Festivo</th>
                                <th class="mdc-data-table__header-cell">Vacaciones</th>
                                <th class="mdc-data-table__header-cell">Comentarios</th>
                            </tr>
                        </thead>
                        <tbody class="mdc-data-table__content"></tbody>
                    </table>
                </div>
                <div id="totalsBar">
                    <div><span>Tiempo trabajado:</span><strong id="totWorked">00:00:00</strong></div>
                    <div><span>Tiempo Decimal:</span><strong id="totDecimal">0</strong></div>
                    <div><span>Tiempo en minutos:</span><strong id="totMinutes">0</strong></div>
                    <div><span>Total horas laborales:</span><strong id="totLabor">0</strong></div>
                    <div><span>Horas previstas:</span><strong id="totExpected">0</strong></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Template modal de Imputaciones -->
    <template id="imputationModalTmpl">
        <div class="modal-backdrop">
            <div class="modal">
                <header>
                    <span class="modal-title">Nueva imputación</span>
                    <button class="close" type="button">×</button>
                </header>
                <form id="imputationForm">
                    <input type="hidden" name="id" />
                    <label>Fecha
                        <input type="date" name="date" required />
                    </label>
                    <label>Hora entrada
                        <input type="time" name="inTime" step="900" required />
                    </label>
                    <label>Hora salida
                        <input type="time" name="outTime" step="900" />
                    </label>
                    <label>Tarea
                        <input name="taskId" list="taskOptions" />
                    </label>
                    <label class="check"><input type="checkbox" name="noFee" /> No Fee</label>
                    <label class="full">Comentarios
                        <input type="text" name="comments" />
                    </label>
                    <footer class="full">
                        <button type="submit" class="Buttons primary">Guardar</button>
                    </footer>
                </form>
            </div>
        </div>
    </template>

    <!-- Snackbar for feedback -->
    <div class="mdc-snackbar" id="saveSnack" data-mdc-auto-init="MDCSnackbar">
        <div class="mdc-snackbar__surface">
            <div class="mdc-snackbar__label" role="status" aria-live="polite">
                Imputación guardada
            </div>
        </div>
    </div>

    <!-- Delete confirmation dialog -->
    <div class="mdc-dialog" id="deleteDialog" data-mdc-auto-init="MDCDialog">
        <div class="mdc-dialog__container">
            <div class="mdc-dialog__surface" role="alertdialog" aria-modal="true">
                <h2 class="mdc-dialog__title">¿Eliminar imputación?</h2>
                <div class="mdc-dialog__content">Esta acción no se puede deshacer.</div>
                <footer class="mdc-dialog__actions">
                    <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="cancel">Cancelar</button>
                    <button type="button" class="mdc-button mdc-dialog__button" data-mdc-dialog-action="delete">Eliminar</button>
                </footer>
            </div>
        </div>
        <div class="mdc-dialog__scrim"></div>
    </div>

    <!-- Scripts -->
    <script defer src="https://cdn.jsdelivr.net/npm/material-components-web@15.0.0/dist/material-components-web.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>window.addEventListener('DOMContentLoaded', () => mdc.autoInit());</script>
    <script src="js/conection-bbdd.js"></script>
    <script src="js/config.js"></script>
    <script src="js/google-ai.js"></script>
    <script src="js/data-loader.js"></script>
    <script src="js/impute-hours.js"></script>
    <script src="js/customers.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/calendar-year.js"></script>
    <script src="js/company.js"></script>
    <script src="js/invoice-print.js"></script>
    <script src="js/invoices.js"></script>
</body>

</html>